{{extend "wiki_layout.html"}}

{{block content_main}}
<style>
#field_title {width:90%;}
#field_content {width:90%;}
</style>

<div class="content-outter">

<h1><a href="{{=url_for('plugs.wiki.views.WikiView.wiki_page', pagename=pagename)}}">{{=pagename}}</a></h1>

<ul class="nav nav-tabs" id="write_form">
  <li class="active"><a href="#write" data-toggle="tab">{{=_('Write')}}</a></li>
  <li><a href="#preview" id="a_preview" data-toggle="tab">{{=_('Preview')}}</a></li>
</ul>
 
<div class="tab-content">
  <div class="tab-pane active" id="write">
    <form class="form-vertical" method="POST" id="preview_form">
    {{build = form.build}}
    {{<< build.body}}
    {{include "inc_generic_attachments_upload.html"}}
    {{attachments_upload(slug, 'wikipage')}}
    {{<< build.buttons_line}}
    </form>
  </div>
  <div class="tab-pane" id="preview">
  </div>
</div>

</div>

<script>
$(function(){
    $('#a_preview').on('shown', function (e) {
        $.post('/wiki/{{=pagename}}/preview', 
            {'content':$('#field_content').val()}).success(function(d){
            $('#preview').html(d.data);
        });
    })
})
</script>
{{end}}
